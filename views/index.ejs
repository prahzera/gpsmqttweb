<!DOCTYPE html>
<html>

<head>
  <title>Dashboard de Seguimiento GPS</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="/css/index.css">
</head>

<body>
  <div class="loader">
    <img src="/images/logo.png" alt="Loading...">
  </div>
  <header class="header">
    <img src="/images/logo.png" alt="Logo" class="logo">
    <h1 class="dashboard-title">Dashboard de Seguimiento GPS</h1>
    <nav class="header-actions">
      <a href="/logout" class="logout-button">Cerrar sesiÃ³n</a>
      <button id="dark-mode-toggle" class="dark-mode-toggle" title="Modo oscuro">ðŸŒ™</button>
    </nav>
  </header>

  <main class="main-content">
    <section class="controls-section">
      <h2 class="section-title">Controles de visualizaciÃ³n</h2>
      <div class="controls-group">
        <div class="controls">
          <label for="timeRange">Historial rÃ¡pido:</label>
          <select id="timeRange">
            <option value="1440">Ãšltimas 24 horas</option>
            <option value="720">Ãšltimas 12 horas</option>
            <option value="180">Ãšltimas 3 horas</option>
            <option value="60">Ãšltima hora</option>
            <option value="30">Ãšltimos 30 minutos</option>
            <option value="15">Ãšltimos 15 minutos</option>
            <option value="10">Ãšltimos 10 minutos</option>
            <option value="5">Ãšltimos 5 minutos</option>
          </select>
        </div>
        <div class="date-range-controls">
          <label>Rango personalizado:</label>
          <div class="date-inputs">
            <div class="date-field">
              <label for="startDate">Desde:</label>
              <input type="date" id="startDate" max="<%= new Date().toISOString().split('T')[0] %>">
            </div>
            <div class="date-field">
              <label for="endDate">Hasta:</label>
              <input type="date" id="endDate" max="<%= new Date().toISOString().split('T')[0] %>">
            </div>
          </div>
          <button id="applyDateRange" class="apply-btn">Aplicar</button>
        </div>
        <div class="distance-summary-minimal">
          <span id="distance-current" title="Distancia recorrida en el intervalo seleccionado">
            <%= totalDistance ? totalDistance.toFixed(2) : '0' %> km
          </span>
        </div>
        <div class="distance-resume-mini">
          <span title="Hoy">H: <span id="distance-day-mini">
            <%= dailyDistances[new Date().toISOString().split('T')[0]] ? dailyDistances[new Date().toISOString().split('T')[0]].toFixed(2) : '0' %> km
          </span></span>
          <span title="Semana">S: <span id="distance-week-mini">
            <% 
              const now = new Date();
              const day = now.getDay() || 7;
              const date = now.getDate();
              const startDate = new Date(now);
              startDate.setDate(date - day + 1);
              const endDate = new Date(startDate);
              endDate.setDate(startDate.getDate() + 6);
              let weekDistance = 0;
              for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dayKey = d.toISOString().split('T')[0];
                if (dailyDistances[dayKey]) {
                  weekDistance += dailyDistances[dayKey];
                }
              }
            %>
            <%= weekDistance.toFixed(2) %> km
          </span></span>
          <span title="Mes">M: <span id="distance-month-mini">
            <% 
              const currentMonth = now.getFullYear() + '-' + (now.getMonth() + 1);
            %>
            <%= monthlyDistances[currentMonth] ? monthlyDistances[currentMonth].toFixed(2) : '0' %> km
          </span></span>
        </div>
      </div>
    </section>

    <section class="map-section">
      <h2 class="section-title">Mapa de Recorrido</h2>
      <div class="map-container">
        <div id="map"></div>
      </div>
    </section>
  </main>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/script.js"></script>
  <script src="/js/night.js"></script>
  <script src="/js/loader.js"></script>
</body>

</html>